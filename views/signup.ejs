<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="/assets/logo.png" type="image/png">
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favalist</title>

    <meta name="description"
        content="Discover, save, and share your favorite things with Favalist. Meet new people with similar taste.">

    <meta name="keywords" content="favorites, list, collection, discovery, sharing, categories, social, dating">
    <meta name="author" content="thenithinbalaji">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Favalist - Your Ultimate Favorite List">
    <meta property="og:description"
        content="Discover, save, and share your favorite things with Favalist. Meet new people with similar taste.">

    <meta property="og:type" content="website">
    <meta property="og:image" content="/assets/thumbnail.jpg">
    <!-- <meta property="og:url" content="https://example.com"> -->

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Galada&display=swap" rel="stylesheet">

    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

    <!-- Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

</head>

<body ng-app="">

    <nav class="w-full p-5">
        <div class="flex flex-col justify-center">
            <a href="/" class="flex gap-2">
                <img src="/assets/logo.png" class="w-8 h-8" alt="Favalist Logo">
                <p class="font-[Galada] text-3xl py-auto">Favalist</p>
            </a>
        </div>
    </nav>

    <div class="flex min-h-full flex-col justify-center px-6 pt-12 pb-4 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-sm">
            <h2 class="text-center text-2xl font-bold leading-9 tracking-tight text-gray-900">Sign up for Favalist
            </h2>
        </div>
    </div>

    <div class="mt-2 sm:mx-auto sm:w-full sm:max-w-sm">
        <form class="space-y-6 px-5" method="POST" name="form" action="/signup">

            <% if (error) { %>
                <h1>
                    <div role="alert">
                        <div class="bg-red-500 text-white font-bold rounded-t px-4 py-2">
                            <%= error %>
                        </div>
                        <div class="border border-t-0 border-red-400 rounded-b bg-red-100 px-4 py-3 text-red-700">
                            <p>The username or email id provided by you is already in use at Favalist. Try using a
                                different
                                username or
                                mail id. Or <a href="/login"
                                    class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500">Login
                                    to Favalist</a>
                            </p>
                        </div>
                    </div>
                </h1>
                <% } else { %>

                    <% } %>

                        <div class="flex justify-center">
                            <div>
                                <div class="flex justify-center h-auto">
                                    <img src="https://robohash.org/{{username}}?bgset=bg2"
                                        class="w-48 rounded-full shadow-lg" ng-show="form.username.$valid">

                                    <img src="/assets/noprofile.jpg" class="w-48 rounded-full shadow-md opacity-50"
                                        ng-hide="form.username.$valid">
                                </div>

                                <div
                                    class='block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 bg-green-100 mt-5'>
                                    <p ng-show="form.username.$valid">
                                        This avatar was generated by hashing your username @{{username}} <br />
                                        Each of this avatar is unique just like your username.
                                    </p>

                                    <p ng-hide="form.username.$valid">
                                        Enter a valid username to generate a Favalist Avatar for you ‚ù§Ô∏è
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Username</label>
                            <div class="mt-2">

                                <input id="name" name="username" type="text" ng-model="username" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4"
                                    pattern="^[A-Za-z]{5,25}$">

                                <div ng-show="form.username.$valid"
                                    class="bg-green-200 rounded-md px-4 py-3 shadow-md mt-2" role="alert">
                                    @{{username}} sounds so cool üòé</div>

                                <div ng-show="form.username.$error.pattern"
                                    class="bg-blue-100 rounded px-4 py-3 shadow-md mt-2" role="alert">
                                    Username must be between 5 and 25 characters and only contain letters</div>
                            </div>
                        </div>


                        <button type="button" onclick="authorize()" id="authorize_button"
                            class="flex w-full justify-center rounded-md bg-black px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">

                            <svg class="h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
                                <path fill="currentColor"
                                    d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8Z">
                                </path>
                                <path
                                    d="M406.6 231.1c-5.2 0-8.4-1.3-12.9-3.9-71.2-42.5-198.5-52.7-280.9-29.7-3.6 1-8.1 2.6-12.9 2.6-13.2 0-23.3-10.3-23.3-23.6 0-13.6 8.4-21.3 17.4-23.9 35.2-10.3 74.6-15.2 117.5-15.2 73 0 149.5 15.2 205.4 47.8 7.8 4.5 12.9 10.7 12.9 22.6 0 13.6-11 23.3-23.2 23.3zm-31 76.2c-5.2 0-8.7-2.3-12.3-4.2-62.5-37-155.7-51.9-238.6-29.4-4.8 1.3-7.4 2.6-11.9 2.6-10.7 0-19.4-8.7-19.4-19.4s5.2-17.8 15.5-20.7c27.8-7.8 56.2-13.6 97.8-13.6 64.9 0 127.6 16.1 177 45.5 8.1 4.8 11.3 11 11.3 19.7-.1 10.8-8.5 19.5-19.4 19.5zm-26.9 65.6c-4.2 0-6.8-1.3-10.7-3.6-62.4-37.6-135-39.2-206.7-24.5-3.9 1-9 2.6-11.9 2.6-9.7 0-15.8-7.7-15.8-15.8 0-10.3 6.1-15.2 13.6-16.8 81.9-18.1 165.6-16.5 237 26.2 6.1 3.9 9.7 7.4 9.7 16.5s-7.1 15.4-15.2 15.4z">
                                </path>
                            </svg>
                            Connect to Spotify
                        </button>

                        <button type="button" id="authorize_success_button"
                            class="hidden w-full justify-center rounded-md bg-green-500 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm  focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                            Connected to Spotify
                        </button>

                        <div>
                            <label for="email" class="block text-sm font-medium leading-6 text-gray-900">Email
                                address</label>
                            <div class="mt-2">
                                <input id="email" name="email" type="email" autocomplete="email" ng-model="email"
                                    required ng-class="{
                            'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 bg-green-100' : form.email.$valid && form.email.$dirty,

                            'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 bg-red-200' : form.email.$invalid && form.email.$dirty,

                            'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 focu' : form.email.$pristine
                        }">
                            </div>
                        </div>

                        <div>
                            <label for="gender" class="block text-sm font-medium leading-6 text-gray-900">Gender</label>
                            <div class="mt-2">
                                <select id="gender" name="gender" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4">
                                    <option value="" disabled selected>Select your gender</option>
                                    <option value="female">Female</option>
                                    <option value="male">Male</option>
                                    <option value="non-binary">Non-binary</option>
                                </select>
                            </div>
                        </div>

                        <div class="hidden text-sm font-medium leading-6 text-gray-900 bg-green-100 rounded-md p-4"
                            id="favorite_artists_block">
                            Favorite Artists (Fetched from Spotify)
                            <ul class="mt-2 list-disc list-inside font-normal" id="favorite_artists">

                            </ul>
                        </div>

                        <div>
                            <label for="color" class="block text-sm font-medium leading-6 text-gray-900">Favorite
                                Color</label>
                            <div class="mt-2">
                                <select id="color" name="color" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4">
                                    <option value="" disabled selected>Select your color</option>

                                    <optgroup label="Rainbow Colors">
                                        <option value="red">Red</option>
                                        <option value="orange">Orange</option>
                                        <option value="yellow">Yellow</option>
                                        <option value="green">Green</option>
                                        <option value="blue">Blue</option>
                                        <option value="indigo">Indigo</option>
                                        <option value="violet">Violet</option>
                                    </optgroup>

                                    <optgroup label="Depression Colors">
                                        <option value="black">Black</option>
                                        <option value="white">White</option>
                                        <option value="pink">Pink</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="flower" class="block text-sm font-medium leading-6 text-gray-900">Favorite
                                Flower</label>
                            <div class="mt-2">
                                <select id="flower" name="flower" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4">

                                    <option value="" disabled selected>Select your favorite flower</option>
                                    <option value="daisy">Daisy</option>
                                    <option value="hibiscus">Hibiscus</option>
                                    <option value="jasmine">Jasmine</option>
                                    <option value="lavender">Lavender</option>
                                    <option value="lily">Lily</option>
                                    <option value="lotus">Lotus</option>
                                    <option value="orchid">Orchid</option>
                                    <option value="rose">Rose</option>
                                    <option value="sunflower">Sunflower</option>
                                    <option value="tulip">Tulip</option>

                                </select>
                            </div>
                        </div>

                        <div class="hidden text-sm font-medium leading-6 text-gray-900 bg-green-100 rounded-md p-4"
                            id="favorite_tracks_block">
                            Favorite Songs (Fetched from Spotify)
                            <ul class="mt-2 list-disc list-inside font-normal" id="favorite_tracks">

                            </ul>
                        </div>

                        <div>
                            <label for="food" class="block text-sm font-medium leading-6 text-gray-900">Favorite
                                Food</label>
                            <div class="mt-2">
                                <select id="food" name="food" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4">
                                    <option value="" disabled selected>Select your favorite food</option>
                                    <option value="bread">Bread</option>
                                    <option value="burger">Burger</option>
                                    <option value="chicken">Chicken</option>
                                    <option value="egg">Egg</option>
                                    <option value="noodles">Noodles</option>
                                    <option value="pizza">Pizza</option>
                                    <option value="rice">Rice</option>
                                    <option value="salad">Salad</option>
                                </select>
                            </div>
                        </div>


                        <div>
                            <label for="animal" class="block text-sm font-medium leading-6 text-gray-900">Favorite
                                Animal</label>
                            <div class="mt-2">
                                <select id="animal" name="animal" required
                                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-4">
                                    <option value="" disabled selected>Select your animal</option>
                                    <option value="capybara">Capybara</option>
                                    <option value="cat">Cat</option>
                                    <option value="dog">Dog</option>
                                    <option value="dragon">Dragon</option>
                                    <option value="hamster">Hamster</option>
                                    <option value="lion">Lion</option>
                                    <option value="phoenix">Phoenix</option>
                                    <option value="rabbit">Rabbit</option>
                                    <option value="turtle">Turtle</option>
                                    <option value="unicorn">Unicorn</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between">
                                <label for="password"
                                    class="block text-sm font-medium leading-6 text-gray-900">Password</label>
                            </div>
                            <div class="mt-2">
                                <input id="password" name="password" type="password" autocomplete="current-password"
                                    ng-model="password" required ng-class="
                            {
                                'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 bg-green-100' : form.password.$valid && form.password.$dirty,
                                
                                'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4 bg-red-200' : form.password.$invalid && form.password.$dirty,

                                'block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-sm sm:leading-6 px-4' : form.password.$pristine

                            }" pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$">

                                <div class="bg-blue-100 border-t-4 border-blue-500 rounded-b px-4 py-3 shadow-md mt-2"
                                    role="alert" ng-hide="form.password.$valid">
                                    <div class="flex">
                                        <div class="py-1">
                                            <svg class="fill-current h-6 w-6 text-blue-500 mr-4"
                                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                                <path
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 110-12 6 6 0 010 12z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-bold">Password must be</p>
                                            <ul class="list-disc list-inside text-sm">
                                                <li>At least 8 characters long</li>
                                                <li>Contains at least one uppercase letter</li>
                                                <li>Contains at least one lowercase letter</li>
                                                <li>Contains at least one digit</li>
                                                <li>Contains at least one special character from @$!%*#?&</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="mt-2">
                                <input type="checkbox" id="data-sharing" name="data-sharing" required
                                    class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="data-sharing" class="ml-2 text-gray-700">I agree to share my data to
                                    Favalist. All the users will be able to interact and view your publicly available
                                    data.</label>
                            </div>
                        </div>

                        <input type="hidden" id="topArtists" name="topArtists" value="">
                        <input type="hidden" id="topTracks" name="topTracks" value="">


                        <button type="submit"
                            class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Sign
                            up</button>

        </form>

        <p class="my-10 text-center text-sm text-gray-500">
            Already a member?
            <a href="/login" class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500">Login to
                Favalist</a>
            <br />
            Form Validation done with AngularJS, JavaScript and ‚ù§Ô∏è
        </p>
    </div>
    </div>

    <script>
        let access_token = null;
        let time_range = 'long_term';
        let limit = '5';
        let redirect_uri = window.location.href;
        console.log(redirect_uri);

        function authorize() {
            const client_id = '84a30a2c50ff492fb162fa65538bbdea';
            const scopes = 'user-top-read playlist-modify-public playlist-modify-private';

            const d = new Date();
            let date = [d.getMonth() + 1, d.getDate(), d.getFullYear()];
            date = date.join('/');

            let url = 'https://accounts.spotify.com/authorize';
            url += '?response_type=token';
            url += '&client_id=' + encodeURIComponent(client_id);
            url += '&scope=' + encodeURIComponent(scopes);
            url += '&redirect_uri=' + encodeURIComponent(redirect_uri);
            window.location = url;
        }

        function getHashValue(key) {
            if (typeof key !== 'string') {
                key = '';
            } else {
                key = key.toLowerCase();
            }
            const keyAndHash = location.hash.match(new RegExp(key + '=([^&]*)'));
            let value = '';

            if (keyAndHash) {
                value = keyAndHash[1];
            }
            return value;
        };

        function getTopArtists() {
            if (access_token) {
                fetch('https://api.spotify.com/v1/me/top/artists?limit=' + limit + '&time_range=' + time_range, {
                    headers: {
                        'Authorization': 'Bearer ' + access_token,
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        artists = []
                        data.items.map((item, i) => {
                            let name = item.name;
                            let id = item.id;
                            artists.push({
                                name: name,
                                id: id
                            });
                        });

                        console.log(artists);

                        ul = document.getElementById('favorite_artists');


                        artists.forEach(artist => {
                            const li = document.createElement('li');
                            li.textContent = artist.name;
                            ul.appendChild(li);
                        });

                        document.getElementById('topArtists').value = JSON.stringify(artists);
                    })
                    .catch(error => {

                    });
            } else {
                alert('Please connect to Spotify.');
            }
        }

        function getTopTracks() {

            if (access_token) {
                fetch('https://api.spotify.com/v1/me/top/tracks?limit=' + limit + '&time_range=' + time_range, {
                    headers: {
                        'Authorization': 'Bearer ' + access_token,
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        tracks = []
                        data.items.map((item, i) => {

                            let trackName = item.name;
                            let artistName = item.artists[0].name;
                            let id = item.id;

                            tracks.push({
                                trackName: trackName,
                                artistName: artistName,
                                id: id
                            });

                        });

                        console.log(tracks);

                        ul = document.getElementById('favorite_tracks');


                        tracks.forEach(track => {
                            const li = document.createElement('li');
                            li.textContent = track.trackName + ' - ' + track.artistName;
                            ul.appendChild(li);
                        });

                        document.getElementById('topTracks').value = JSON.stringify(tracks);
                    })
                    .catch(error => {

                    });
            } else {
                alert('Please connect to Spotify.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            access_token = getHashValue('access_token');
            if (access_token) {
                document.getElementById('authorize_button').style.display = 'none';

                document.getElementById('authorize_success_button').classList.remove('hidden');
                document.getElementById('authorize_success_button').classList.add('flex');

                document.getElementById('favorite_artists_block').classList.remove('hidden');
                document.getElementById('favorite_artists_block').classList.add('block');

                document.getElementById('favorite_tracks_block').classList.remove('hidden');
                document.getElementById('favorite_tracks_block').classList.add('block');

                getTopArtists()
                getTopTracks()
            }
        });
    </script>
</body>

</html>